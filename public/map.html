<!DOCTYPE html>

<html lang="en-CA">
	<head>
		<title>ITELiveMap</title>

		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="theme-color" content="#00597C" />

		<!-- <script src="https://kit.fontawesome.com/c6ef7d4818.js" crossorigin="anonymous"></script> -->

		<meta property="og:url" content="https://ite.fyi/map" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="ITELiveMap" />
		<meta property="og:description" content="ITELiveMap" />
		<meta property="og:image" content="https://ite.fyi/ITE%20logo%20-%20regular.png" />

		<meta name="description" content="ITELiveMap" />
		<meta name="keywords" content="live, Minecraft, map" />

		<style>
			* {
				margin: 0;
				border: 0;
				padding: 0;
			}

			body {
				width: 100dvw;
				height: 100dvh;

				overflow: hidden;
				cursor: grab;
			}

			div.map-square {
				position: absolute;

				width: 10px;
				height: 10px;
			}
		</style>
	</head>

	<body>
		<div class="map"></div>

		<script type="module">
			"use strict";

			const SIZE = 10;
			const REGION_SIZE = 16;

			let screenWidth = window.innerWidth;
			let screenHeight = window.innerHeight;
			let offsetZ = screenHeight / 2 - SIZE / 2;
			let offsetX = screenWidth / 2 - SIZE / 2;

			import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
			import { getDatabase, ref, set, get, push, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

			const firebaseConfig = {
				apiKey: "AIzaSyDJO9lZG6BGaXXn140P6hhSdLTPx1oVM90",
				authDomain: "ite-fyi.firebaseapp.com",
				databaseURL: "https://ite-fyi-default-rtdb.firebaseio.com",
				projectId: "ite-fyi",
				storageBucket: "ite-fyi.firebasestorage.app",
				messagingSenderId: "976641175922",
				appId: "1:976641175922:web:1792e862b235fee7d26deb",
			};
			const app = initializeApp(firebaseConfig);
			const database = getDatabase();

			async function setMap() {
				document.querySelector(".map").innerHTML = ""; // clear "canvas"

				await get(ref(database, "mc/map"))
					.then((result) => {
						let data = result.val();

						for (let region in data) {
							let regionX = region.split(",")[0];
							let regionZ = region.split(",")[1];
							let blockIndex = 0;

							for (let x = regionX * REGION_SIZE; x < regionX * REGION_SIZE + REGION_SIZE; x++) {
								for (let z = regionZ * REGION_SIZE; z < regionZ * REGION_SIZE + REGION_SIZE; z++) {
									let red = data[region].substring(blockIndex, blockIndex + 2);
									let green = data[region].substring(blockIndex + 2, blockIndex + 4);
									let blue = data[region].substring(blockIndex + 4, blockIndex + 6);

									let square = document.createElement("div");
									square.classList.add("map-square");
									square.style = `top: ${z * SIZE + offsetZ}px; left: ${x * SIZE + offsetX}px; background-color: #${red}${green}${blue}`;
									document.querySelector(".map").appendChild(square);

									blockIndex += 6;
								}
							}
						}
					})
					.catch((error) => {
						console.error(error);
					});
			}
			setMap();

			// PAN
			let fromX = 0,
				fromY = 0,
				toX = 0,
				toY = 0;
			window.addEventListener("mousedown", (event) => {
				fromX = event.pageX;
				fromY = event.pageY;
			});
			window.addEventListener("mouseup", (event) => {
				toX = event.pageX;
				toY = event.pageY;

				offsetZ -= fromY - toY;
				offsetX -= fromX - toX;

				setMap();
			});
		</script>
	</body>
</html>
